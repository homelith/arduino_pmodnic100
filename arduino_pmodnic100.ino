#include "Enc424J600Network.h"

int pkt_count = 0;
uint8_t mac[6] = {0x00,0x01,0x02,0x03,0x04,0x05};
uint8_t ping[74] = 
{
  0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff, 0x00, 0x01,
  0x02, 0x03, 0x04, 0x05, 0x08, 0x00, 0x45, 0x00,
  0x00, 0x3c, 0x2c, 0x0a, 0x00, 0x00, 0x80, 0x01,  
  0x00, 0x00, 0xc0, 0xa8, 0x64, 0x01, 0xc0, 0xa8,
  0x64, 0x02, 0x08, 0x00, 0x4d, 0x5a, 0x00, 0x01,
  0x00, 0x01, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66,
  0x67, 0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e,
  0x6f, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76,
  0x77, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67,
  0x68, 0x69
};

void setup() {
  
  Serial.begin(9600);
  Enc424J600Network::init((uint8_t*)mac);
  Serial.write("init done\n");
}

void loop() {
  memhandle handle = Enc424J600Network::allocBlock(74);
  Enc424J600Network::writePacket(handle, 0, (uint8_t*)ping, 74);
  Enc424J600Network::sendPacket(handle);
  Enc424J600Network::freeBlock(handle);
  
  Serial.println(pkt_count);
  pkt_count++;
  delay(5000);
}
